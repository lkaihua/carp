{{define "folder_content_default"}}
<script>document.querySelector("#CategorySelector #Col-all").classList.add("active");</script>

<section id="FolderContent" class="folder_content_default">
    <div style="display: flex; align-items: center; gap: 10px;">
        <a href="../" class="btn navigation-button navigation-back"><span class="icon arrow-up"></span></a>
        <h6 class="mt-1 mb-1">{{.CountAll}} Files</h6>
    </div>
    {{ $category := .Category }}
    <div class="filter-type-container">
        <select id="AllFilter" class="form-select form-select-sm">
            <option value="" {{ if eq $category "image-video" }}selected{{ end }}>Filter by</option>
            <option value="video" {{ if eq $category "video" }}selected{{ end }}>Only show video ({{.CountVideo}})</option>
            <option value="image" {{ if eq $category "image" }}selected{{ end }}>Only show image ({{.CountImage}})</option>
        </select>
    </div>

    <script>
        document.querySelector("#FolderContentHeader").onchange = function(evt) {
            window.location.href = window.location.pathname + "?category=all&sortBy=" + evt.target.value
        }
    </script>

    

    {{ with .DisplayEntries }}
    <script>
    window.EntryRows = window.EntryRows || [];
    window.EntryRow = window.EntryRow || [];

    window.h  = [];
    </script>

    {{ range . }}
        <script>
        window.h.push([
            '{{ .EntryType }}',
            '{{ .FirstName }}',
            '{{ .LastName }}',
            '{{ .ModTimeString }}',
            '{{ .SizeString }}',
        ]);
        </script>
    {{ end }}
    
    <ul class="item-list mx-0 border-1 my-2">
        {{ range . }}
        <li>
            {{ if eq .EntryType "folder" }}
                <a class="item-primary dropdown-item item-entry-type-{{- .EntryType }}" href="{{ .UrlString }}">
                    {{ template "item_primary_content" dict "EntryType" .EntryType "FirstName" .FirstName "LastName" .LastName "ModTimeString" .ModTimeString "SizeString" .SizeString }}
                </a>
            {{ else }}
                <a class="item-primary dropdown-item item-entry-type-{{- .EntryType }}" href="{{ .UrlString }}"
                    data-bs-toggle="modal" data-bs-target="#PreviewModal" 
                    data-bs-url-string="{{.UrlString}}"
                    data-bs-name="{{.Name}}"
                    data-bs-firstName="{{.FirstName}}"
                    data-bs-lastName="{{.LastName}}"
                    data-bs-entry-type="{{.EntryType}}"
                >
                    {{ template "item_primary_content" dict "EntryType" .EntryType "FirstName" .FirstName "LastName" .LastName "ModTimeString" .ModTimeString "SizeString" .SizeString}}
                </a>
                <!-- Preview Button starts -->
                {{ if eq .EntryType "image" }}
                    <script>
                        window.EntryRows.push([
                            '<button type="button" class="btn border rounded btn-preview btn-preview-{{- .EntryType }}"',
                                'data-bs-toggle="modal" data-bs-target="#PreviewModal"',
                                'data-bs-url-string="{{.UrlString}}"',
                                'data-bs-name="{{.Name}}"',
                                'data-bs-firstName="{{.FirstName}}"',
                                'data-bs-lastName="{{.LastName}}"',
                                'data-bs-entry-type="{{.EntryType}}"',
                            '>',
                                '{{ $previewImageUrl := .UrlString }}',
                                '{{ if .HasThumbnail }}{{ $previewImageUrl = .HasThumbnail }}{{ end }}',
                                '<img data-src="{{$previewImageUrl}}" class="image-preview lazyload" />',
                            '</button>',
                        ].join(""));
                    </script>
                {{ else if eq .EntryType "music" }}
                    <script>
                        window.EntryRows.push([
                            '<button type="button" class="btn border rounded btn-preview btn-preview-{{- .EntryType }}"',
                                'data-bs-toggle="modal" data-bs-target="#PreviewModal"',
                                'data-bs-url-string="{{.UrlString}}"',
                                'data-bs-name="{{.Name}}"',
                                'data-bs-firstName="{{.FirstName}}"',
                                'data-bs-lastName="{{.LastName}}"',
                                'data-bs-entry-type="{{.EntryType}}"',
                            '> ',
                                '<span class="pos-relative music-preview rounded border-1 flex-center">',
                                    '{{ if .HasThumbnail }}<img data-src="{{.HasThumbnail}}" class="image-preview lazyload" />{{ end }}',
                                    '<span class="pos-absolute-max flex-center">',
                                        '<span class="icon music-note"></span>',
                                    '</span>',
                                '</span>',
                            '</button>',
                        ].join(""));
                        
                    </script>
                {{ else if eq .EntryType "video" }}
                    
                        window.EntryRows.push([
                            <button type="button" class="btn border rounded btn-preview btn-preview-{{- .EntryType }}"
                                data-bs-toggle="modal" data-bs-target="#PreviewModal" 
                                data-bs-url-string="{{.UrlString}}"
                                data-bs-name="{{.Name}}"
                                data-bs-firstName="{{.FirstName}}"
                                data-bs-lastName="{{.LastName}}"
                                data-bs-entry-type="{{.EntryType}}"
                            >   
                                <span class="pos-relative video-preview rounded border-1 flex-center">
                                    {{ if .HasThumbnail }}
                                    <img data-src="{{.HasThumbnail}}" class="video-preview lazyload" />
                                    {{ end }}
                                    <span class="pos-absolute-max flex-center">
                                        <span class="icon video-play"></span>
                                    </span>
                                </span>
                            </button>
                        `);
                    </script>
                {{ end }}
                <script>
                    if (window.EntryRow.length == 3) {
                        window.EntryRows.push(`<div class="row row-cols-3">${window.EntryRow.join("")}</div>`)
                        window.EntryRow = []
                    }
                </script>
                <!-- Preview Button ends -->
            {{ end }}
        </li>
        {{ else }}
        <li> Ops! Nothing here. </li>
        {{ end }}
    </ul>
    <script>
        // window.addEventListener("load", function(event) { 
        //     if (window.EntryRow && window.EntryRow.length > 0) {
        //         window.EntryRows.push(`<div class="row row-cols-3">${window.EntryRow.join("")}</div>`)
        //     }
        //     // update max-height of ImageVideoContainer
        //     const imageVideoContainer = document.querySelector("#ImageVideoContainer")
        //     imageVideoContainer.style.maxHeight = window.innerHeight - imageVideoContainer.offsetTop + "px"
            
        //     window.clusterize = new Clusterize({
        //         rows: window.ImageVideoRows,
        //         scrollId: 'ImageVideoContainer',
        //         contentId: 'ImageVideoItems',
        //         callbacks: {
        //             clusterChanged: () => window.lazyload && window.lazyload(document.querySelectorAll(".lazyload"), {rootMargin: "25%"}),
        //         }
        //     })
        // })
    </script>
    
    {{ template "preview_modal" }}

    {{ else }}
    <div class="empty-folder-placeholder my-4 border rounded-3 align-items-center justify-content-center p-3 py-6">
        <h4>The folder is empty.</h4>
    </div>
    {{ end }}
</section>
{{ end }}
